# RNA-Seq Analysis Pipeline

Author: Yining Liang  
Last updated: 2026-01-09  
Platform: Linux  
Shell: bash

This repository contains a step-by-step RNA-seq analysis pipeline,
from raw FASTQ files to gene-level count matrix.

Pipeline includes:
- FastQC (quality control)
- Bowtie2 (read alignment)
- Samtools (SAM/BAM processing)
- featureCounts (gene counting)

------------------------------------------------------------
Directory Structure
------------------------------------------------------------

RNAseq_lyn/
├── reference/
│   └── bowtie2_index/
│       └── hg38.*.bt2
├── data/
│   ├── QC/
│   ├── BW2/
│   ├── BAM/
│   └── Counts/
├── scripts/
│   ├── generate_fastqc_sh.sh
│   ├── generate_bowtie2_sh.sh
│   ├── generate_samtools_sh.sh
│   └── generate_featurecounts_sh.sh

------------------------------------------------------------
Software Requirements
------------------------------------------------------------

Required tools:
- fastqc
- bowtie2
- samtools
- subread (featureCounts)

Check installation:
fastqc --version
bowtie2 --version
samtools --version
featureCounts -v

------------------------------------------------------------
Global Variables Used in Scripts
------------------------------------------------------------

WORK_DIR=/home/fanlj/RNAseq_lyn
QC_DIR=/home/fanlj/RNAseq_lyn/data/QC
BW2_DIR=/home/fanlj/RNAseq_lyn/data/BW2
BAM_DIR=/home/fanlj/RNAseq_lyn/data/BAM
COUNTS_DIR=/home/fanlj/RNAseq_lyn/data/Counts
BW2_INDEX=/home/fanlj/RNAseq_lyn/ref_genome/bowtie2_index/hg38
GTF_FILE=/home/fanlj/RNAseq_lyn/ref_genome/hg38.gtf

------------------------------------------------------------
Step 1: Quality Control (FastQC)
------------------------------------------------------------

Input:
- sample_1.fq.gz
- sample_2.fq.gz

Command example:
fastqc sample_1.fq.gz sample_2.fq.gz -t 4 -o QC/

Output:
- HTML and ZIP reports in QC/

------------------------------------------------------------
Step 2: Read Alignment (Bowtie2)
------------------------------------------------------------

Input:
- Paired-end FASTQ files

Command example:
bowtie2 -x hg38 \
  -1 sample_1.fq.gz \
  -2 sample_2.fq.gz \
  --very-sensitive \
  -p 8 \
  -S sample_bw2.sam

Output:
- sample_bw2.sam
- bowtie2 log file (with alignment rate)

------------------------------------------------------------
Step 3: BAM Processing (Samtools)
------------------------------------------------------------

IMPORTANT:
BAM files must be sorted before indexing.

Correct order:
SAM -> BAM -> sorted BAM -> BAM index

Commands:
samtools view -@ 8 -bS sample_bw2.sam > sample_bw2.bam
samtools sort -@ 8 -o sample_bw2.sorted.bam sample_bw2.bam
samtools index sample_bw2.sorted.bam

Output:
- sample_bw2.sorted.bam
- sample_bw2.sorted.bam.bai

------------------------------------------------------------
Step 4: Gene Counting (featureCounts)
------------------------------------------------------------

Input:
- Sorted BAM files
- GTF annotation file

Command example:
featureCounts -T 8 \
  -a hg38.gtf \
  -o sample_counts.txt \
  sample_bw2.sorted.bam

Output:
- Gene-level count table
- Rows: genes
- Columns: samples

------------------------------------------------------------
Running the Pipeline
------------------------------------------------------------

Generate per-sample scripts:
sh generate_fastqc_sh.sh
sh generate_bowtie2_sh.sh
sh generate_samtools_sh.sh
sh generate_featurecounts_sh.sh

Run one sample in background:
nohup sh bowtie2_B5R1.sh &
nohup sh samtools_B5R1.sh &
nohup sh featurecounts_B5R1.sh &

Logs are automatically generated with timestamps.

------------------------------------------------------------
Downstream Analysis
------------------------------------------------------------

The gene count matrix generated by featureCounts can be used for:
- DESeq2
- edgeR
- limma-voom

------------------------------------------------------------
Notes
------------------------------------------------------------

1. All BAM files must be coordinate-sorted before indexing.
2. Reference genome and GTF must match.
3. Logs are written per sample and per step.
4. Pipeline is modular and reproducible.

------------------------------------------------------------
End of README
------------------------------------------------------------
